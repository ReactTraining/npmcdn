'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _tarFs = require('tar-fs');

var _tarFs2 = _interopRequireDefault(_tarFs);

var _mkdirp = require('mkdirp');

var _mkdirp2 = _interopRequireDefault(_mkdirp);

var _gunzipMaybe = require('gunzip-maybe');

var _gunzipMaybe2 = _interopRequireDefault(_gunzipMaybe);

var _request = require('request');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getPackage(tarballURL, outputDir, callback) {
  (0, _mkdirp2.default)(outputDir, function (error) {
    if (error) {
      callback(error);
    } else {
      (function () {
        var callbackWasCalled = false;

        (0, _request.get)({ url: tarballURL }).pipe((0, _gunzipMaybe2.default)()).pipe(_tarFs2.default.extract(outputDir, {
          map: function map(header) {
            header.name = header.name.replace(/^package\//, '');
            return header;
          }
        })).on('finish', callback).on('error', function (error) {
          if (callbackWasCalled) // LOL request
            return;

          callbackWasCalled = true;
          callback(error);
        });
      })();
    }
  });
}

exports.default = getPackage;